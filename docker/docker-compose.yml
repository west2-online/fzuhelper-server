
services:
  fzu-helper-redis:
    container_name: fzu-helper-redis
    image: redis
    volumes:
      - ./data/redis:/data
    ports:
      - "6379:6379"
    networks:
      - fzu-helper


  etcd:
    container_name: etcd
    image: "quay.io/coreos/etcd:v3.5.5"
    restart: always
    ports:
      - 2379:2379
      - 2380:2380
    environment:
      - ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379
      - ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379
      - ETCD_API=3
      - ALLOW_NONE_AUTHENTICATION=yes
    volumes:
      - ./script:/script
      - ../config:/config
      - ../data/etcd:/etcd-data
    networks:
      - fzu-helper
    entrypoint: [ "sh", "-c", "chmod +x /script/etcd-monitor.sh && /script/etcd-monitor.sh & exec etcd" ]


  api:
    image: api_image
    networks:
      - fzu-helper
    container_name: api
    restart: always
    ports:
      - "20001:20001"

  classroom:
    image: classroom_image
    networks:
      - fzu-helper
    container_name: classroom
    restart: always
    ports:
      - "20002:20002"


  user:
    image: user_image
    networks:
      - fzu-helper
    container_name: user
    restart: always
    ports:
      - "20003:20003"


networks:
  fzu-helper:
    driver: bridge
